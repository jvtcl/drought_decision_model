\documentclass[11pt]{article}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\usepackage{amsmath}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\title{Mathematical representation of the drought decision model}
\author{Trisha Shrum}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle
%\section{}
%\subsection{}


\section{Indices}
\begin{itemize}
\item Time is indexed by $t$, units in years. Variables with this index are allowed to vary by year.
\item Insurance decision is indexed by $i$, where $i=1$ corresponds to the purchase of insurance and $i=0$
\item Revenues and costs are indexed by the presence of drought and the drought adaptation measure: 
	\begin{itemize}
	\item base (base),
	\item nd (no drought, equivalent to base),
	\item noadpt (drought, no adaptation), 
	\item feed (drought, buy feed), 
	\item rent (drought, rent pasture),
	\item sell (drought, sell and replace)
	\end{itemize}
\end{itemize}


\section{Data}
\begin{itemize}
\item Grid base data (what is this?): \verb!grid_base.RData!, called in \verb!load.R! script
\item Insurance base data (what is this?): \verb!insurance_base.RData!, called in \verb!load.R! script
\item NOAA Index (be more specific): \verb!noaaIndex.RData!, called in \verb!load.R! script
\item Coops (what is this?): \verb!coops.RData!, called in \verb!load.R! script
\item MLRA zone data (be more specific): \verb!mlra=readOGR("data","mlra_v42")!  called in \verb!load.R! script. \textit{I don't know what this function means}
\end{itemize}

\section{Profit Model}
\begin{equation}
\pi_t = R_{d,t} - C_{d,t}
\end{equation}

\subsection{Revenues}
Base sales: 
\begin{itemize}
\item Function: \verb!CalculateExpSales! 
\item Inputs: $h$ = \verb!herd! (herd size (number of cows, does not include calves)), $\phi$ = \verb!calf.sell! (average percentage of calves sold), $w_{t}$ = \verb!wn.wt! (calf weight at weaning in year \(t\) (pounds)), $p_{t}$ = \verb!p.wn!(price of calves at weaning in year \(t\) (\$/pound))
\end{itemize}

\begin{equation} \label{baserevenues}
R_{base, t} = \phi h * w_t * p_t
\end{equation}


\subsection{Costs}
Total Cost Function:
\begin{equation}
C_{total,t} = C_{base, t} + iprem_t
\end{equation}


\subsubsection{Base costs}
\begin{itemize}
\item Function: \verb!CalculateBaseOpCosts!
	\begin{itemize}
	\item Inputs: \(h\) \verb!herd! (number of cows, does not include calves), \(\gamma\) = \verb!cow.cost! (base operating costs (\$/cow))
	\end{itemize}
\end{itemize}

\begin{equation}
C_{base,t} = \gamma h 
\end{equation}


\section{Drought Adaptation}
Drought Adaptation Options:
\begin{enumerate}
\item Do Nothing
\item Buy Feed
\item Rent Pasture
\item Sell Pairs and Replace
\end{enumerate}

\textbf{How much adaptation is needed?} 
Depends on the length of adaptation action ($\lambda$ = \verb!days.act!) and the intensity of the drought ($\alpha$ = \verb!forage.potential!). Different drought adaptation actions are scaled slightly differently to account for fixed costs (e.g., trucking) and variables costs (e.g., days of pasture rental). 

\begin{itemize}
\item Function: \verb!CalculateDaysAction!
	\begin{itemize}
	\item Description: Calculate the number of days rancher pays for a drought adaptation action. 
	\item Inputs: \verb!act.st.yr! (year the action starts), \verb!act.st.m! (month the action starts), \verb!act.end.yr! (year the action ends), \verb!act.end.m! (month the action ends)
	\item Outputs: Number of days drought adaptation action takes place (days) (\verb!days.act!)
	\item Assumptions: Assumes that the actions take place only in one year.
	\item Limitation: Not equipped to handle drought adaptation in multiple years. Currently only works for the first year (bug identified).
	\end{itemize}
\end{itemize}

\begin{equation} \label{days}
\lambda = 30 * (\verb!act.end.m! - \verb!act.end.m!)
\end{equation}

\begin{itemize}
\item Function: \verb!CalculateAdaptationIntensity!
	\begin{itemize}
	\item Description: Takes forage potential and an adaptation intensity factor to provide a scalar of drought action. If forage potential is above 1 (no drought), then this variable goes to 0 (no adaptation). 
	\item Inputs: \(\psi\) = \verb!adpt.intensity.factor! (parameter that scales adaptation actions to reflect actual adaptation behavior. Currently defaults to 1 which assumes a one-to-one ratio of drops in forage percentage to need for forage replacement.), \(\alpha\) = \verb!forage.potential! (the percentage of average forage produced in a year based on rainfall. See forage potential functions.)
	\item Output: \verb!drght.act.adj! (scales action to account for forage potential's deviation from the norm.)
	\item Assumptions: The variable has a maximum of 1, which assumes that drought actions are parameterized at full forage replacement for the full herd.
	\end{itemize}
\end{itemize}

\begin{equation} \label{intens}
\beta = \verb!drght.act.adj!=
\begin{cases}
\min\{1,(1-\alpha)*\psi)\} & \text{if}\ \alpha \le 0 \\
0 & \text{else}.
\end{cases}
\end{equation}


\subsection{Drought Adaptation Option: Do Nothing}
If ranchers do nothing when forage potential drops below 1, then calves do not gain as much weight and cows produce fewer calves. 

\subsubsection{Costs}
coming soon...

\subsubsection{Revenues}
coming soon...

\subsection{Drought Adaptation Option: Buy Feed}
\subsubsection{Costs}
In addition to base costs, $C_{base,t}$, with the buy feed adaptation option, we add the cost of buying feed according to the following function:
\begin{itemize}
\item Function: \verb!CalculateFeedCost!
	\begin{itemize}
	\item Description: Calculating the costs of purchasing additional feed
	\item Inputs: $ration_{ray}$ = \verb!hay.ration! (hay ration assuming no grazing (pounds/head/day) \textbf{Source needed}), $p_{hay}$ = \verb!p.hay! (price of hay (\$/ton). user input), $ration_{oth}$ = \verb!oth.ration! (ration of non-hay feed (pounds/head/day) \textbf{Source needed}, $p_{oth}$ = \verb!p.oth! (price of other feed (\$/ton). User input. Does not come into play since the model assumes only feeding hay), $\beta$ = \verb!intens.adj! (drought intensity adjustment, eq. \ref{intens}), $\lambda$ = \verb!days.act! (days adaptation action (days), eq. \ref{days}), $h$ = \verb!herd! (size of herd (head of cows, does not include calves))
	\item Outputs: \verb!cost.feed! (additional costs to feed the herd over the remainder of the season (\$/year))
	\end{itemize}
\end{itemize}

\begin{equation}
C_{feed,t} = \beta \lambda h \left(\frac{ration_{hay}}{2000} * p_{hay} + \frac{ration_{oth}}{2000} * p_{oth} \right)
\end{equation}

\subsubsection{Revenues}
Revenues are unchanged from the base level. ( eq. \ref{baserevenues})
\begin{equation}
R_{feed,t} = R_{base,t}
\end{equation}

\subsection{Drought Adaptation: Rent Pasture}
\subsubsection{Costs}
In addition to base costs, we add the cost of renting pasture according to the following function:
\begin{itemize}
\item Function: \verb!CalculatePastureRentCost!
	\begin{itemize}
	\item Description: Calculates the costs of renting pasture and trucking pairs
	\item Inputs: $m$ = \verb!n.miles! (distance to rented pasture (miles)), $p_{truck}$ = \verb!truck.cost! (trucking cost per loaded mile (\$/mile/truck)), $p_{rent}$ = \verb!past.rent! (price of renting pasture per animal unit month, where an animal unit is a cow/calf pair (\$/pair/month)), $\beta$ = \verb!intens.adj! (portion of herd moving to rented pasture), $\lambda$ = \verb!days.act! (days on rented pasture(days), $C_{fixed}$ = \verb!oth.cost! (all other non-rental, non-trucking costs (\$)), $w_{max}$ = \verb!max.wt! (maximum weight per truck (pounds)), $w_cow$ = \verb!cow.wt! (average cow weight (pounds)), $w_{calf}$ = \verb!calf.wt! (average 'current' weight of calves before trucking to rented pasture (pounds)), $h$ =\verb!herd! (size of herd (head of cows, does not include calves))
	\item Output: \verb!cost.rentpast! (total costs of using renting pasture including transport costs on top of normal operating costs (\$/year))
	\item Assumptions: Only cows are trucked back home. Fixed costs cover transaction costs (time, etc.) of arranging pasture rental.
	\end{itemize}
\end{itemize}

Number of trucks needed to transport portion of herd (pairs) to rented pasture:
\begin{equation}
n_{to} = \lceil \beta h * \lceil w_{max} / (w_{cow} + w_{calf}) \rceil \rceil
\end{equation}
Number of trucks needed to transport portion of herd (cows only) back to home pasture:
\begin{equation}
n_{from} = \lceil \beta h * \lceil w_{max} / w_{cow} \rceil \rceil
\end{equation}

Cost of hiring trucks:
\begin{equation}
C_{trucks} =  m * p_{truck} (n_{to} + n_{from})
\end{equation}

Cost of renting pasture:
\begin{equation}
C_{past} = \beta \lambda h  \frac{p_{rent}}{30} 
\end{equation}

Total cost of ranching operation with drought adaptation through rental pasture:
\begin{equation}
C_{rent,t} = C_{trucks} + C_{past} + C_{fixed} + C_{base}
\end{equation}


\subsubsection{Revenues}
Due to losses during the stress of trucking cows and calves, the revenues are lower than normal.

\begin{itemize}
\item Function: \verb!CalculateRentPastRevenue!
	\begin{itemize}
	\item Description: Calculates calf sale revenues after trucking pairs to rented pastures
	\item Inputs: \verb!calf.loss! (additional calf deaths due to transport stress (head of calves)), \verb!calf.wt.adj! (adjustment for calf weaning weights (\%)), \verb!calf.sell! (average percentage of calves sold (\%)), $w_t$ = \verb!wn.wt! (average weight at weaning (pounds)), $p_t$ = \verb!p.wn! (expected sale price of calves (\$/pound)), \verb!herd! (size of herd (head of cows, does not include calves)), $\beta$ = \verb!intens.adj! (portion of herd moving to rented pasture)
  \item Outputs: \verb!rev.rentpast! (change in revenue due to mortality and weight loss from trucking to rented pasture)
	\end{itemize}
\end{itemize}	 

Number of calves sold after accounting for calf mortality in transport:
\begin{equation} 
calves_{rent} = h * \beta * \verb!calf.sell! - \verb!calf.loss!
\end{equation}
\begin{equation}
calves_{home} = h * (1-\beta) * \verb!calf.sell!
\end{equation}
  
Selling weight after accounting for weight loss due to transport stress
\begin{equation}
wt_{rent} <- wt_{normal} * (1 + \verb!calf.wt.adj!)
\end{equation}
  
Expected calf sale revenues
\begin{equation}
R_{rent} = p_{wn} ( calves_{rent} * wt_{rent} + calves_{home} * wt_{normal})
\end{equation} 

\subsection{Drought Adaptation: Sell and Replace}

\subsubsection{Costs}
When a rancher sells the herd, the operating costs of the ranch drops in the year the herd is sold, includes only basic fixed operating costs when there is no herd, and then goes back to normal base operating costs.

\begin{itemize}
\item Function: CalculateSellPrsCost
	\begin{itemize}
	\item Description: Calculates the operating costs to sell pairs in year 1 and replacing cows in year 3
	\item Inputs: \verb!op.cost.adj! (change in operating costs in year 1 per cow after selling herd (\$/cow/year)), \verb!sell.cost! (selling cost per cow (\$/cow)), $h$ = \verb!herd! (size of herd (head of cows, does not include calves)), \verb!base.cost! (baseline annual cost of operating ranch with full herd (\$/year)), \verb!fixed.op.cost! (fixed operating costs for a year without a herd (\$/year))
	\item Outputs: \verb!cost.sellprs! (5x1 vector of changes in operating costs for years 1 through 5 from selling pairs in year 1 and replacing them at the end of year 3)
  	\item Assumptions: 
  		\begin{itemize}
  		\item It is assumed that cows are replaced on last day of the second year after they are sold. For example, cows sold in 2011 are replaced on 12/31/2013. 
  		\item The adjustment in operating costs does not depend on when the herd is sold. 
  		\item Selling costs are additional to normal selling costs. 
  		\item No additional purchasing costs are added when the herd is restocked.
  		\item The herd size is the same before and after selling the herd.
  		\item Entire herd is sold.
  		\end{itemize}
	\end{itemize}
\end{itemize}

\begin{align*}
C_{sell, 1} &= C_{base} + h (op.cost.adj + sell.cost) \\
C_{sell, 2} &= C_{herdless} \\
C_{sell, 3} &= C_{herdless} \\
C_{sell, 4} &= C_{base} \\
C_{sell, 5} &= C_{base}
\end{align*}

\subsubsection{Revenues}
\begin{itemize}
\item   Function: CalculateSellPrsRev
	\begin{itemize}
	\item Description: Calculates calf sales revenues due to selling pairs and replacing cows for years 1 through 3
  	\item Inputs: \verb!base.sales! (calf sales in a normal year (\$/year)), $p_{current}$ = \verb!p.wn.t0! (current sale price calves (\$/pound), $h$ = \verb!herd! (size of herd (head of cows, does not include calves)), \verb!wn.succ! (average percentage of cows that successfully wean calves (\%)), $w_{current}$ = \verb!calf.wt! (average 'current' weight of calves (pounds))
  	\item Outputs: \verb!rev.sellprs! (5x1 vector of calf revenues for years 1 through 5)
  	\item Assumptions: It is assumed that cows are replaced on last day of the second year after they are sold. 
  For example, cows sold in 2011 are replaced on 12/31/2013. The herd size is the same before and after selling the herd. Entire herd is sold.
	\end{itemize}
\end{itemize}
\begin{align*}
R_{sell, 1} &= h * wn.succ * w_{current} * p_{current} \\
R_{sell, 2} &= 0 \\
R_{sell, 3} &= 0 \\
R_{sell, 4} &= R_{base, 4} \\
R_{sell, 5} &= R_{base, 5}
\end{align*}

\section{Assets and Net Worth}
Calculating assets and net worth.

\begin{itemize}
\item Function: CapitalAssets
	\begin{itemize}
	\item Description: Caluclated the cow assets for each year.
	\item Inputs: \verb!herd!, $p_{cow}$ = \verb!p.cow!, \verb!sell.year! (year the herd is sold. single numeric value. default is year 1.), \verb!replace.year! (year the herd is replaced. single numeric value. default is year 3).
	\item Output: $A_{cow}$ = \verb!cow.assets! (6x1 vector of cow assets for each year, including t=0)
	\end{itemize}
\end{itemize}

If herd is never sold:
\begin{equation}
A_{cow,t} = h * p_{cow}
\end{equation}

If herd is sold and replaced:
\begin{equation}
A_{cow,t} =  
\begin{cases}
h * p_{cow}, & \text{if  } t < t_{sell},  t > t_{replace}, \text{or } t_{sell} = \varnothing \\
0, & \text{if  } t_{sell} \le t < t_{replace} \\
\end{cases}
\end{equation}

\begin{itemize}
\item Function: CalcCapSalesPurch
	\begin{itemize}
	\item Description: Calculates vectors of capital sales and capital purchases from changes in assets.cow. Assumes sale/purchase of cows is only capital sales/purchase
  	\item Inputs: \verb!assets.cow! (tx1 vector of the value of cow assets each year)
  	\item Outputs: \verb!cap.sales! (tx1 vector of capital sales for each year), \verb!cap.purch! (tx1 vector of capital purchases for each year)
	\end{itemize}
\end{itemize}

\begin{itemize}
\item Function: CalcCapTaxes
	\begin{itemize}
	\item Description: Calculates capital taxes on herd sales. Tax treatment is different depending on whether herd is sold and replaced by the end of the third year or if the herd is sold and not replaced during a drought emergency.
	\item Inputs: \verb!cap.sales!, \verb!cap.purch!, \verb!cap.tax.rate!, \verb!drought.emrg! (binary variable to indicate whether drought emergency was in place when the herd was sold currently set to a default of 1. This only matters if the herd is sold and not replaced.)
	\item Outputs: \verb!cap.taxes! (5x1 vector of capital taxes)
	\item Assumptions: Assumes that the entire herd is sold and replaced at the same rate. Not sure how the tax code treats changes in prices. This abstracts away from that. The price dynamics could matter here, but for now we are leaving them out.
	\end{itemize}
\end{itemize}


\section{Insurance Model}
\begin{itemize}
\item Function: \verb!insMat!
	\begin{itemize}
	\item Description: Generates a matrix representing insurance premium payments and indemnities for a specified grid cell over a five-year interval. 
	\item Inputs: \verb!tgrd! (target grid cell), \verb!yyr! (starting year), \verb!clv! (coverage level), \verb!acres! (insured acres), \verb!pfactor! (land productivity factor), \verb!insPurchase! (a matrix representing insurance allocation to two-month intervals, with rows written in the format [mm,amt])
	\item Outputs: a 5 x n? matrix with insurance premium payments (column ?) and indemnities (column ?) for a specified grid cell over a five-year interval. 
	\end{itemize}
\end{itemize}
	
\begin{itemize}
\item Function: \verb!droughtCalculator!
	\begin{itemize}
	\item Inputs: \verb!yy! (year of interest), \verb!clv! (RMA coverage level. Accepted values 
  are 0.7, 0.75, 0.8, 0.85, 0.9), \verb!acres! (insured acres), \verb!pfactor! (productivity factor of grazing land), \verb!insPurchase! (a m? x n? matrix of intervals from 1-11 for which insurance is purchased. For example, purchases for the April-May and May-June intervals at 50\% protection each would be entered as `rbind(c(3,0.5),c(5,0.5))` Consecutive intervals are not allowed.)
	\item Outputs (list): \verb!prem_noSbdy! (total premium with subsidy), \verb!prem_wSbdy! (total premium without subsidy), \verb!prodPrem! (premium paid by producer), \verb!indemrate! (indemnity rate (stack, by month)), \verb!indemnity! (indemnity (stack, by month)), \verb!indemtot! (total indemnity)  
	\item Requirements: Insurance allocation for consecutive intervals is not permitted. Insurance must be allocated for at least two intervals. Insurance allocation intervals must range from 1-11. Insurance allocation may not exceed 60\% per interval. Insurance allocation must sum to 100\%.
	\end{itemize}
\end{itemize}

Coverage Subsidies (\verb!covsub!):
\begin{center}
\begin{tabular}{cc}
\hline
Coverage Level & Subsidy Rate \\
70\% & 59\% \\
75\% & 59\% \\
80\% & 55\% \\
85\% & 55\% \\
90\% & 51\% \\
\hline
\end{tabular}
\end{center}

\begin{equation}
sbdy = 
\begin{cases}
0.59, & \text{if}\ \verb!clv! \le 0.75 \\
0.55, & \text{if}\ 0.75 < \verb!clv! < 0.90 \\
0.51, & \text{if}\ \verb!clv! \ge 0.90 
\end{cases}
\end{equation}

Insurance Purchase (\verb!insPurchase!, \verb!insp!):

Default:Excel model defaults
\verb!ins! = 
\( \begin{bmatrix}
3 & 0.5 \\
5 & 0.5 \\
\end{bmatrix}\) 

Option "autoSelect.insurance":
\begin{itemize}
\item Function: \verb!insAlloc!
	\begin{itemize}
	\item Description: Automates range insurance allocation to two-month RMA intervals using a grid cell/COOP site's forage potential weights. Returns a matrix formatted as the `insPurchase` input for function `insMat`. Allocation for chosen two-month intervals is roughly proportional to the relative value of each interval's forage potential weight. Adjustments to allocation percentages are automatically made if a selection is invalid for one or more intervals, either too high ($>$60\%) or too low (10\%). User-specified min/max allocation percentages falling within this range may also be substituted by setting the `max.alloc` and `min.alloc` arguments.
	\item Inputs: \verb!fpwt! (A vector of monthly forage potential weights for the target site. Monthly intervals are averaged to two-month intervals to match RMA insurance selections.), \verb!niv! (number of two-month intervals to insure), \verb!by.rank! (if TRUE (default), ranks forage potential weights by interval in descending order and selects the `niv` most highly ranked non-consecutive intervals to insure. If FALSE, selects the combination of `niv` non-consecutive two-month intervals with the highest average forage potential weights.), \verb!max.alloc!  (maximum interval allocation, 0.6), \verb!min.alloc! (minimum interval allocation, 0.1).
	\item Outputs: 
	\end{itemize}
\end{itemize}



\begin{itemize}	
\item Helper Function: \verb!dcInfo! (extracts drought calculator information from a grid cell), inputs: \verb!dc! (drought calculator output), \verb!tgrd! (target grid cell id)
\end{itemize}



\section{Limitations}
Currently not equipped to handle multi-year droughts. This can be changed. 





\end{document}  